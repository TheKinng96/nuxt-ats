# i18n System Documentation

This project uses a hybrid i18n (internationalization) system with both **central translations** for common terms and **component-level translations** for component-specific content. The system provides full TypeScript autocomplete support for all translation keys.

## Supported Languages

- **Japanese (ja)** - 日本語 **(Only language)**

## Architecture Overview

```
apps/web/
├── i18n/                       # i18n configuration
│   └── locales/                # Central translations
│       ├── en.ts               # English common translations
│       ├── ja.ts               # Japanese common translations
│       └── index.ts            # Type exports
├── vue-i18n.config.ts          # Vue I18n configuration
├── types/
│   └── i18n.d.ts               # TypeScript definitions for autocomplete
├── composables/
│   └── useComponentI18n.ts     # Component-level i18n composable
├── components/
│   └── common/
│       ├── LanguageSwitcher.vue
│       └── LanguageSwitcher.locale.ts    # Example component locale
└── pages/
    ├── index.vue
    └── index.locale.ja.ts                   # Example page locale
```

## Path Aliases

Nuxt provides two aliases for cleaner imports:

- **`~` or `@`**: Points to the app root (`apps/web/`)

**Examples:**
```ts
// Instead of: import { something } from '../../../types/i18n'
import { something } from '~/types/i18n'
// or
import { something } from '@/types/i18n'

// Component imports
import locales from './ComponentName.locale'  // Same directory
import { useComponentI18n } from '~/composables/useComponentI18n'  // From root
```

## Central Translations

Central translations are defined in `i18n/locales/en.ts` and `i18n/locales/ja.ts`. These contain common translations used throughout the application:

- **Buttons**: save, cancel, delete, edit, etc.
- **Navigation**: home, dashboard, candidates, etc.
- **Status**: active, inactive, pending, etc.
- **Messages**: success, error, warning, etc.
- **Validation**: required, email, phone, etc.

### Usage

```vue
<script setup lang="ts">
const { t } = useI18n()
</script>

<template>
  <button>{{ t('common.buttons.save') }}</button>
  <p>{{ t('common.messages.loading') }}</p>
</template>
```

## Component-Level Translations

Component-level translations are co-located with their components using the pattern `ComponentName.locale.ts`. This keeps translations close to where they're used and prevents naming conflicts.

### Creating Component Locales

1. **Create a `.locale.ja.ts` file** next to your component:

```ts
// components/candidates/CandidateList.locale.ja.ts
export default {
  candidateList: {
    title: '候補者',
    searchPlaceholder: '候補者を検索...',
    noResults: '候補者が見つかりません',
    columns: {
      name: '名前',
      email: 'メール',
      status: 'ステータス'
    }
  }
}
```

2. **Use the locale in your component**:

```vue
<script setup lang="ts">
import ja from './CandidateList.locale.ja'

// This provides typed autocomplete for all translation keys!
const { t } = useComponentI18n({ messages: { ja } })
</script>

<template>
  <div>
    <h1>{{ t('candidateList.title') }}</h1>
    <input :placeholder="t('candidateList.searchPlaceholder')" />

    <!-- You can still access central translations -->
    <button>{{ t('common.buttons.save') }}</button>
  </div>
</template>
```

## TypeScript Autocomplete

The system provides full autocomplete support in both `<script>` and `<template>` sections:

### In Script Section
```ts
const { t } = useComponentI18n(locales)

// Autocomplete works here!
const title = t('candidateList.title')
const saveButton = t('common.buttons.save')
```

### In Template
```vue
<template>
  <!-- Autocomplete works in templates too! -->
  <h1>{{ t('candidateList.title') }}</h1>
  <button>{{ t('common.buttons.save') }}</button>
</template>
```

## Naming Conventions

### Component Locale Namespace
Always namespace your component translations under a unique key:

✅ **Good:**
```ts
{
  en: {
    candidateList: {  // Namespaced
      title: 'Candidates'
    }
  }
}
```

❌ **Bad:**
```ts
{
  en: {
    title: 'Candidates'  // Not namespaced - could conflict!
  }
}
```

### File Naming
- Locale files: `ComponentName.locale.ja.ts`
- Components: `ComponentName.vue`
- Use the same base name for consistency

## Language Switcher

The `LanguageSwitcher` component allows users to switch between languages:

```vue
<template>
  <LanguageSwitcher />
</template>
```

The selected language is persisted in a cookie (`i18n_redirected`) and will be remembered across sessions.

## Adding a New Language

To add a new language (e.g., Spanish - es):

1. **Create locale file**: `i18n/locales/es.ts`
2. **Update `i18n/locales/index.ts`**:
   ```ts
   import es from './es'

   export const messages = {
     en,
     ja,
     es  // Add here
   }

   export const availableLocales = ['en', 'ja', 'es'] as const
   ```

3. **Update `nuxt.config.ts`**:
   ```ts
   i18n: {
     locales: [
       { code: 'en', iso: 'en-US', name: 'English', file: 'en.ts' },
       { code: 'ja', iso: 'ja-JP', name: '日本語', file: 'ja.ts' },
       { code: 'es', iso: 'es-ES', name: 'Español', file: 'es.ts' }  // Add here
     ]
   }
   ```

4. **Update component locales**: Add `es` key to all `*.locale.ts` files

## Date and Number Formatting

The system includes date and number formatters:

### Dates
```vue
<script setup lang="ts">
const { d } = useI18n()
const date = new Date()
</script>

<template>
  <p>{{ d(date, 'short') }}</p>  <!-- 12/25/2024 or 2024年12月25日 -->
  <p>{{ d(date, 'long') }}</p>   <!-- December 25, 2024, 3:00 PM -->
</template>
```

### Numbers
```vue
<script setup lang="ts">
const { n } = useI18n()
const price = 1234.56
</script>

<template>
  <p>{{ n(price, 'currency') }}</p>  <!-- $1,234.56 or ¥1,235 -->
  <p>{{ n(price, 'decimal') }}</p>   <!-- 1,234.56 -->
</template>
```

## Best Practices

1. **Use component-level locales** for component-specific content
2. **Use central locales** for common, reusable terms
3. **Always namespace** component translations
4. **Use direct export** for simple message objects
5. **Keep translations close** to where they're used
6. **Be consistent** with naming (use same base name for `.vue` and `.locale.ja.ts`)
7. **Test both languages** when adding new translations

## Example Component Structure

```
components/candidates/
├── CandidateList.vue          # Component
├── CandidateList.locale.ja.ts    # Component translations
├── CandidateForm.vue          # Another component
└── CandidateForm.locale.ja.ts    # Its translations
```

## Troubleshooting

### Autocomplete not working?
1. Restart your TypeScript server in VS Code
2. Check that `types/i18n.d.ts` exists
3. Ensure locale files use `as const` for type inference

### Translation not showing?
1. Check browser console for missing key warnings
2. Verify the key path is correct
3. Check that both `en` and `ja` have the same structure
4. Make sure you imported and passed messages to `useComponentI18n({ messages: { ja } })`

### Language not switching?
1. Check browser console for errors
2. Verify the language code matches locale files
3. Clear cookies and try again
4. Check that `i18n_redirected` cookie is being set

## Resources

- [Vue I18n Documentation](https://vue-i18n.intlify.dev/)
- [@nuxtjs/i18n Module](https://i18n.nuxtjs.org/)
- [TypeScript Deep Dive - Type Inference](https://basarat.gitbook.io/typescript/)
